<!DOCTYPE HTML>
<!--
	Paradigm Shift by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
    <title>Hello World</title>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#ffffff">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" href="assets/css/main.css" />
</head>

<body class="is-preload">

    <table>
        <tr>
            <th>№</th>
            <th>Заказ</th>
            <th>Срок</th>
            <th>Статус</th>
            <th>Действия</th>
        </tr>
        <tr>
            <td>1</td>
            <td><a href="files/new.txt" download>Заказ</a></td>
            <td>30/02/2023</td>
            <td id="status"><img id="statusimg" src="images/greenc.png" height="20" width="20">Доступен</td>
            <td>
                <button onclick="takeWork()">Взять в работу</button>
                <form id="formElem">
                    <input type="file">
                    <button type="submit">Новый файл</button>
                </form>
            </td>
        </tr>
    </table>
    <iframe id="frmFile" src="file1.json" style="display: none;"></iframe>
    <div id="form">
        <form name="nabor">
            <input name="Название" value="Набор" disabled>
            <input name="Номер" value="1">
            <input name="Сканер" list="scanners">
        </form>
        <div>Данные набора:</div>
        <form name="data">
            <input name="Штрихкод" onchange="newForm()">
            <input name="Количество" id="quantity">
            <input name="Серия" id="inaRow">
        </form>
        <datalist id="scanners">
            <option value="Сканер1">
            <option value="Сканер2">
        </datalist>
    </div>
    <button onclick="sending()">Взять числа</button>
    <button onclick="kill()">Завершить работу</button>
    <button onclick="saySum();">Посчитать</button>
    <script>
        let i = 1
        // заполним FormData данными из формы
        function sending() {
            let formData = new FormData(document.forms.nabor);
            index = "data";
            // if(i == 1){
            let formFormData = new FormData(document.forms[index]);
            // }else{
            //     let formFormData = new FormData(document.forms[index+i]);
            // }
            let xhr = new XMLHttpRequest();
            var object = {};
            formData.forEach(function(value, key) {
                object[key] = value;
            });
            let dataobj = {};
            formFormData.forEach(function(value, key) {
                dataobj[key] = value;
            });
            object["Данные"] = dataobj;
            var json = JSON.stringify(object);

            xhr.open("POST", '/files')
            xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');

            xhr.send(json);
        }

        function kill() {
            let xhr = new XMLHttpRequest();

            xhr.open('GET', '127.0.0.3:2526/kill')

            xhr.send()
        }

        function takeWork() {
            document.getElementById("status").innerHTML = "\<img id=\"statusimg\" src=\"images/yellowc.png\" height=\"20\" width=\"20\"\>В работе"
        }

        function saySum() {
            function readTextFile(file, callback) {
                var rawFile = new XMLHttpRequest();
                rawFile.overrideMimeType("application/json");
                rawFile.open("GET", file, true);
                rawFile.onreadystatechange = function() {
                    if (rawFile.readyState === 4 && rawFile.status == "200") {
                        callback(rawFile.response);
                    }
                }
                rawFile.send(null);
            }

            //usage:
            readTextFile("/file1.json", function(text) {
                var data = JSON.parse(text);
                document.getElementById("start").innerHTML = data;
                document.getElementById("sum1").innerHTML = data['a'];
                document.getElementById("sum2").innerHTML = data.b;
                document.getElementById("sum").innerHTML = Number(data.a) + Number(data.b);
            });
        }
        function newForm(){
            let form = document.createElement("form");
            form.className = "data" + i;
            form.innerHTML = "<input name==\"Штрихкод\" onchange==\"newForm()\"><input name==\"Количество\" id==\"quantity\"><input name==\"Серия\" id==\"inaRow\">"
            document.body.append(form);
            i++;
        }

    </script>
</body>

</html>
